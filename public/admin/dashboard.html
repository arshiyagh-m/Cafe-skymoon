<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ú©Ø§ÛŒ Ù…ÙˆÙ†</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/misc/Farsi-Digits/font-face.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { font-family: 'Vazirmatn', sans-serif; }</style>
</head>
<body class="bg-gray-900 text-white flex h-screen overflow-hidden">

    <aside class="w-64 bg-gray-800 border-l border-gray-700 flex flex-col hidden md:flex">
        <div class="p-6 text-center border-b border-gray-700">
            <h1 class="text-xl font-bold text-yellow-500">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <button onclick="switchTab('reservations')" class="w-full text-right px-4 py-3 rounded hover:bg-gray-700 focus:bg-gray-700 text-gray-300 transition"><i class="fas fa-calendar-alt ml-3"></i>Ø±Ø²Ø±ÙˆÙ‡Ø§</button>
            <button onclick="switchTab('menu')" class="w-full text-right px-4 py-3 rounded hover:bg-gray-700 focus:bg-gray-700 text-gray-300 transition"><i class="fas fa-utensils ml-3"></i>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ùˆ</button>
            <button onclick="switchTab('gallery')" class="w-full text-right px-4 py-3 rounded hover:bg-gray-700 focus:bg-gray-700 text-gray-300 transition"><i class="fas fa-images ml-3"></i>Ú¯Ø§Ù„Ø±ÛŒ</button>
            <button onclick="switchTab('theme')" class="w-full text-right px-4 py-3 rounded hover:bg-gray-700 focus:bg-gray-700 text-gray-300 transition"><i class="fas fa-paint-brush ml-3"></i>Ø¸Ø§Ù‡Ø± Ùˆ ØªÙ…</button>
        </nav>
        <div class="p-4">
            <button id="logoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded">Ø®Ø±ÙˆØ¬</button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-8 relative">
        
        <section id="reservations-section" class="tab-content">
            <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-2">
                <h2 class="text-3xl font-bold text-yellow-500">Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h2>
                <button onclick="loadReservations()" class="text-sm text-gray-400 hover:text-white"><i class="fas fa-sync ml-1"></i>Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
            </div>
            <div id="reservations-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="text-gray-400">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>
            </div>
        </section>

        <section id="menu-section" class="tab-content hidden">
            <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-2">
                <h2 class="text-3xl font-bold text-yellow-500">Ù„ÛŒØ³Øª Ù…Ù†Ùˆ</h2>
                <button onclick="document.getElementById('addMenuModal').classList.remove('hidden')" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500 text-sm font-bold"><i class="fas fa-plus ml-2"></i>Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒØªÙ…</button>
            </div>
            
            <div class="overflow-x-auto bg-gray-800 rounded-lg">
                <table class="w-full text-right">
                    <thead class="bg-gray-700 text-yellow-500">
                        <tr>
                            <th class="p-4">ØªØµÙˆÛŒØ±</th>
                            <th class="p-4">Ù†Ø§Ù… Ø¢ÛŒØªÙ…</th>
                            <th class="p-4">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                            <th class="p-4">Ù‚ÛŒÙ…Øª</th>
                            <th class="p-4">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="menu-table-body"></tbody>
                </table>
            </div>
        </section>

        <section id="gallery-section" class="tab-content hidden">
            <div class="bg-gray-800 p-6 rounded-lg mb-8 border border-gray-700">
                <h2 class="text-xl font-bold text-yellow-500 mb-4">Ø§ÙØ²ÙˆØ¯Ù† ØªØµÙˆÛŒØ± Ø¨Ù‡ Ú¯Ø§Ù„Ø±ÛŒ</h2>
                <form id="uploadGalleryForm" class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="w-full">
                        <label class="block text-gray-400 text-sm mb-2">Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ±</label>
                        <input type="url" id="galleryUrl" placeholder="https://..." required class="w-full bg-gray-900 text-white rounded p-2 text-sm border border-gray-700 text-left" dir="ltr">
                    </div>
                    <div class="w-full">
                         <label class="block text-gray-400 text-sm mb-2">ØªÙˆØ¶ÛŒØ­ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                         <input type="text" id="galleryCaption" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙØ¶Ø§ÛŒ ØªÙˆÙ„Ø¯" class="w-full bg-gray-900 text-white rounded p-2 border border-gray-700 focus:border-yellow-500 outline-none">
                    </div>
                    <button type="submit" class="bg-green-600 hover:bg-green-500 text-white px-6 py-2.5 rounded font-bold whitespace-nowrap transition h-fit">Ø§ÙØ²ÙˆØ¯Ù†</button>
                </form>
            </div>
            <div id="gallery-admin-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </section>

        <section id="theme-section" class="tab-content hidden">
            <h2 class="text-3xl font-bold mb-6 text-yellow-500 border-b border-gray-700 pb-2">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¸Ø§Ù‡Ø± Ø³Ø§ÛŒØª</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <div class="bg-gray-800 p-6 rounded-lg border border-gray-700">
                    <form id="themeForm" class="space-y-6">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ (Accent Color)</label>
                            <div class="flex gap-2 items-center">
                                <input type="color" id="primaryColorPicker" class="h-10 w-10 bg-transparent border-0 cursor-pointer rounded">
                                <input type="text" id="primaryColorText" class="flex-1 bg-gray-700 rounded p-2 text-white text-left" dir="ltr">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ (ØªÙ… Ø§ØµÙ„ÛŒ)</label>
                            <div class="flex gap-2 items-center">
                                <input type="color" id="bgColorPicker" class="h-10 w-10 bg-transparent border-0 cursor-pointer rounded">
                                <input type="text" id="bgColorText" class="flex-1 bg-gray-700 rounded p-2 text-white text-left" dir="ltr">
                            </div>
                        </div>

                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <label class="block text-sm text-yellow-500 mb-2 font-bold"><i class="fas fa-holly-berry ml-2"></i>Ø­Ø§Ù„Øª Ù…Ù†Ø§Ø³Ø¨ØªÛŒ (Ø§ÙÚ©Øª ÙˆÛŒÚ˜Ù‡)</label>
                            <select id="occasionSelect" class="w-full bg-gray-700 text-white p-3 rounded focus:outline-none focus:border-yellow-500 border border-gray-600">
                                <option value="none">Ø³Ø§Ø¯Ù‡ (Ø¨Ø¯ÙˆÙ† Ø§ÙÚ©Øª)</option>
                                <option value="christmas">ğŸ„ Ú©Ø±ÛŒØ³Ù…Ø³ (Ø¨Ø±Ù + ØªÙ… Ø²Ù…Ø³ØªØ§Ù†ÛŒ)</option>
                                <option value="yalda">ğŸ‰ Ø´Ø¨ ÛŒÙ„Ø¯Ø§ (ØªÙ… Ù‚Ø±Ù…Ø² + Ø§Ù†Ø§Ø±)</option>
                                <option value="nowruz">ğŸŒ± Ø¹ÛŒØ¯ Ù†ÙˆØ±ÙˆØ² (Ø´Ú©ÙˆÙÙ‡ + Ø³Ø¨Ø²Ù‡)</option>
                                <option value="valentine">â¤ï¸ ÙˆÙ„Ù†ØªØ§ÛŒÙ† (Ù‚Ù„Ø¨ + ØªÙ… ØµÙˆØ±ØªÛŒ)</option>
                            </select>
                        </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 h-fit">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-yellow-500 mb-2 font-bold"><i class="fas fa-image ml-2"></i>ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</label>
                            <input type="url" id="heroImageInput" placeholder="https://..." class="w-full bg-gray-900 text-white rounded p-3 border border-gray-600 text-left focus:border-yellow-500 focus:outline-none" dir="ltr">
                        </div>
                        <div>
                            <label class="block text-sm text-green-400 mb-2 font-bold"><i class="fas fa-utensils ml-2"></i>ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ØµÙØ­Ù‡ Ù…Ù†Ùˆ</label>
                            <input type="url" id="menuBgInput" placeholder="https://..." class="w-full bg-gray-900 text-white rounded p-3 border border-gray-600 text-left focus:border-green-500 focus:outline-none" dir="ltr">
                            <p class="text-xs text-gray-500 mt-1">Ø§ÛŒÙ† ØªØµÙˆÛŒØ± Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù„ÛŒØ³Øª ØºØ°Ø§Ù‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-yellow-500 text-black font-bold py-3 rounded hover:bg-yellow-400 transition mt-6">Ø°Ø®ÛŒØ±Ù‡ ØªÙ…Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <div id="addMenuModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-gray-800 p-6 rounded-lg w-96 border border-gray-600 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 text-white">Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯</h3>
            <form id="addMenuForm" class="space-y-3">
                <input type="text" id="itemName" placeholder="Ù†Ø§Ù… ØºØ°Ø§/Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ" required class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600">
                <input type="text" id="itemCategory" placeholder="Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ (Ù…Ø«Ù„Ø§Ù‹: coffee)" required class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600">
                <input type="number" id="itemPrice" placeholder="Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)" required class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600">
                <input type="url" id="itemImage" placeholder="Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" class="w-full bg-gray-900 p-2 rounded text-white text-left border border-gray-600" dir="ltr">
                <textarea id="itemDesc" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª..." class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600"></textarea>
                <div class="flex justify-end gap-2 mt-4">
                    <button type="button" onclick="document.getElementById('addMenuModal').classList.add('hidden')" class="px-4 py-2 text-gray-400 hover:text-white">Ù„ØºÙˆ</button>
                    <button type="submit" class="px-4 py-2 bg-yellow-500 text-black rounded font-bold hover:bg-yellow-400">Ø°Ø®ÛŒØ±Ù‡</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editMenuModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-gray-800 p-6 rounded-lg w-96 border border-yellow-500 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 text-yellow-500">ÙˆÛŒØ±Ø§ÛŒØ´ Ø¢ÛŒØªÙ…</h3>
            <form id="editMenuForm" class="space-y-3">
                <input type="hidden" id="editItemId">
                <input type="text" id="editItemName" required class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600">
                <input type="text" id="editItemCategory" required class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600">
                <input type="number" id="editItemPrice" required class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600">
                <input type="url" id="editItemImage" class="w-full bg-gray-900 p-2 rounded text-white text-left border border-gray-600" dir="ltr">
                <textarea id="editItemDesc" class="w-full bg-gray-700 p-2 rounded text-white border border-gray-600"></textarea>
                <div class="flex justify-end gap-2 mt-4">
                    <button type="button" onclick="document.getElementById('editMenuModal').classList.add('hidden')" class="px-4 py-2 text-gray-400 hover:text-white">Ù„ØºÙˆ</button>
                    <button type="submit" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-black rounded font-bold">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // =========================================================
        // Û°. Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
        // =========================================================
        const isLoggedIn = localStorage.getItem('isAdminLoggedIn');
        if (isLoggedIn !== 'true') window.location.href = "login.html";
        
        document.getElementById('logoutBtn').addEventListener('click', () => { 
            if(confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) { 
                localStorage.removeItem('isAdminLoggedIn'); 
                window.location.href = 'login.html'; 
            }
        });

        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId + '-section').classList.remove('hidden');
        }

        // =========================================================
        // Û±. Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø²Ø±ÙˆÙ‡Ø§
        // =========================================================
        async function loadReservations() {
            const container = document.getElementById('reservations-list');
            try {
                const res = await fetch('/api/reservations');
                if(!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø·');
                const list = await res.json();
                
                container.innerHTML = '';
                if(list.length === 0) { 
                    container.innerHTML = '<p class="text-gray-500">Ù‡ÛŒÚ† Ø±Ø²Ø±ÙˆÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</p>'; 
                    return; 
                }

                list.forEach(item => {
                    container.innerHTML += `
                        <div class="bg-gray-800 p-4 rounded border-r-4 border-yellow-500 shadow relative">
                            <h3 class="font-bold text-lg text-white mb-2">${item.name}</h3>
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-clock ml-1"></i> ${item.date} | ${item.time}</p>
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-users ml-1"></i> ${item.guests} Ù†ÙØ± | ${item.phone}</p>
                            <button onclick="deleteRes('${item.id}')" class="text-red-400 text-sm absolute top-4 left-4 hover:text-red-200 transition"><i class="fas fa-trash"></i></button>
                        </div>`;
                });
            } catch (e) { container.innerHTML = '<p class="text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø±Ø²Ø±ÙˆÙ‡Ø§</p>'; }
        }
        window.deleteRes = async (id) => { if(confirm('Ø­Ø°Ù Ø±Ø²Ø±ÙˆØŸ')) { await fetch(`/api/reservations/${id}`, { method: 'DELETE' }); loadReservations(); } }

        // =========================================================
        // Û². Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ùˆ (Ø¨Ø§ Ø³ØªØ§Ø±Ù‡ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´)
        // =========================================================
        async function loadMenu() {
            const tableBody = document.getElementById('menu-table-body');
            try {
                const res = await fetch('/api/menu');
                const list = await res.json();
                tableBody.innerHTML = '';
                
                list.forEach(item => {
                    const price = Number(item.price).toLocaleString();
                    const imgUrl = item.image || 'https://via.placeholder.com/50';
                    const safeName = item.name.replace(/'/g, "&apos;");
                    const safeDesc = (item.description || "").replace(/'/g, "&apos;");

                    const starColor = item.is_featured ? 'text-yellow-400' : 'text-gray-600 hover:text-yellow-400';
                    const starIcon = item.is_featured ? 'fas' : 'far';

                    tableBody.innerHTML += `
                        <tr class="border-b border-gray-700 hover:bg-gray-700/50 transition">
                            <td class="p-4"><img src="${imgUrl}" class="w-10 h-10 rounded object-cover bg-gray-600"></td>
                            <td class="p-4 font-bold text-white">
                                ${item.name}
                                ${item.is_featured ? '<span class="text-[10px] bg-yellow-500 text-black px-1.5 py-0.5 rounded mr-2 font-bold">ÙˆÛŒÚ˜Ù‡</span>' : ''}
                            </td>
                            <td class="p-4 text-sm text-gray-400">${item.category}</td>
                            <td class="p-4 text-yellow-500 font-bold">${price}</td>
                            <td class="p-4 flex gap-2 justify-end items-center">
                                <button onclick="toggleFeature('${item.id}')" class="${starColor} text-lg px-2 transition transform hover:scale-110" title="Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø³Ø±Ø¢Ø´Ù¾Ø²">
                                    <i class="${starIcon} fa-star"></i>
                                </button>
                                <button onclick="openEditModal('${item.id}', '${safeName}', '${item.category}', '${item.price}', '${item.image||''}', '${safeDesc}')" class="bg-blue-600 px-2 py-1 rounded text-white hover:bg-blue-500"><i class="fas fa-edit"></i></button>
                                <button onclick="deleteItem('${item.id}')" class="bg-red-600 px-2 py-1 rounded text-white hover:bg-red-500"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                });
            } catch (e) { console.error(e); }
        }

        window.toggleFeature = async (id) => { 
            try {
                const res = await fetch(`/api/menu/${id}/toggle-feature`, { method: 'PATCH' });
                if(res.ok) loadMenu();
                else alert('Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª');
            } catch(e){ alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±'); }
        }
        
        document.getElementById('addMenuForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.innerText = 'Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...'; btn.disabled = true;

            const data = { 
                name: document.getElementById('itemName').value, 
                category: document.getElementById('itemCategory').value, 
                price: document.getElementById('itemPrice').value, 
                description: document.getElementById('itemDesc').value, 
                image: document.getElementById('itemImage').value 
            };

            try {
                const res = await fetch('/api/menu', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                if(res.ok) {
                    document.getElementById('addMenuModal').classList.add('hidden'); 
                    e.target.reset(); 
                    loadMenu();
                    alert('Ø¢ÛŒØªÙ… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                }
            } catch(err) { alert('Ø®Ø·Ø§'); }
            finally { btn.innerText = 'Ø°Ø®ÛŒØ±Ù‡'; btn.disabled = false; }
        });

        window.openEditModal = (id, name, cat, price, img, desc) => {
            document.getElementById('editItemId').value = id;
            document.getElementById('editItemName').value = name;
            document.getElementById('editItemCategory').value = cat;
            document.getElementById('editItemPrice').value = price;
            document.getElementById('editItemImage').value = img;
            document.getElementById('editItemDesc').value = desc;
            document.getElementById('editMenuModal').classList.remove('hidden');
        };

        document.getElementById('editMenuForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editItemId').value;
            const data = { 
                name: document.getElementById('editItemName').value, 
                category: document.getElementById('editItemCategory').value, 
                price: document.getElementById('editItemPrice').value, 
                description: document.getElementById('editItemDesc').value, 
                image: document.getElementById('editItemImage').value 
            };
            await fetch(`/api/menu/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
            document.getElementById('editMenuModal').classList.add('hidden'); 
            loadMenu();
        });

        window.deleteItem = async (id) => { if(confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) { await fetch(`/api/menu/${id}`, { method: 'DELETE' }); loadMenu(); } }

        // =========================================================
        // Û³. Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø§Ù„Ø±ÛŒ
        // =========================================================
        async function loadGallery() {
            const container = document.getElementById('gallery-admin-grid');
            try {
                const list = await (await fetch('/api/gallery')).json();
                container.innerHTML = '';
                list.forEach(i => {
                    container.innerHTML += `
                        <div class="relative group aspect-square rounded overflow-hidden bg-black border border-gray-700">
                            <img src="${i.image}" class="w-full h-full object-cover">
                            <button onclick="deleteGalleryImage('${i.id}')" class="absolute top-2 right-2 bg-red-600 w-8 h-8 rounded-full flex items-center justify-center text-white hover:bg-red-500 shadow-lg transition"><i class="fas fa-trash"></i></button>
                        </div>`;
                });
            } catch(e) { console.error(e); }
        }

        document.getElementById('uploadGalleryForm').addEventListener('submit', async(e)=>{
            e.preventDefault(); 
            const btn = e.target.querySelector('button'); btn.innerText = '...'; btn.disabled = true;
            try {
                await fetch('/api/gallery', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ image:document.getElementById('galleryUrl').value, caption:document.getElementById('galleryCaption').value }) }); 
                e.target.reset(); loadGallery(); alert('ØªØµÙˆÛŒØ± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            } catch(e) { alert('Ø®Ø·Ø§'); }
            finally { btn.innerText = 'Ø§ÙØ²ÙˆØ¯Ù†'; btn.disabled = false; }
        });

        window.deleteGalleryImage = async(id)=>{ if(confirm('Ø­Ø°Ù Ø¹Ú©Ø³ØŸ')){ await fetch(`/api/gallery/${id}`, {method:'DELETE'}); loadGallery(); } };

        // =========================================================
        // Û´. ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ… (Ø±Ù†Ú¯ + ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ + Ù…Ù†Ø§Ø³Ø¨Øª)
        // =========================================================
        async function loadThemeSettings() {
            try {
                const res = await fetch('/api/theme');
                const theme = await res.json();
                
                document.getElementById('primaryColorPicker').value = theme.primary || '#d4af37';
                document.getElementById('primaryColorText').value = theme.primary || '#d4af37';
                document.getElementById('bgColorPicker').value = theme.bg || '#0f0f0f';
                document.getElementById('bgColorText').value = theme.bg || '#0f0f0f';
                
                document.getElementById('occasionSelect').value = theme.occasion || 'none';
                document.getElementById('heroImageInput').value = theme.heroImage || ''; 
                document.getElementById('menuBgInput').value = theme.menuBg || ''; // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¹Ú©Ø³ Ù…Ù†Ùˆ
            } catch(e) {}
        }

        document.getElementById('themeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                primary: document.getElementById('primaryColorText').value,
                bg: document.getElementById('bgColorText').value,
                occasion: document.getElementById('occasionSelect').value,
                heroImage: document.getElementById('heroImageInput').value,
                menuBg: document.getElementById('menuBgInput').value // Ø°Ø®ÛŒØ±Ù‡ Ø¹Ú©Ø³ Ù…Ù†Ùˆ
            };
            await fetch('/api/theme', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
            alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
        });

        ['primary', 'bg'].forEach(t => {
            document.getElementById(t+'ColorPicker').addEventListener('input', e => document.getElementById(t+'ColorText').value = e.target.value);
            document.getElementById(t+'ColorText').addEventListener('input', e => document.getElementById(t+'ColorPicker').value = e.target.value);
        });

        loadReservations(); loadMenu(); loadGallery(); loadThemeSettings();

    </script>
</body>
</html>

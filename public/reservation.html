<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø²Ø±Ùˆ Ù…ÛŒØ² | Ú©Ø§ÙÙ‡ Ø§Ø³Ú©Ø§ÛŒ Ù…ÙˆÙ†</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/misc/Farsi-Digits/font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Vazirmatn', 'sans-serif'] },
                    colors: { gold: { 500: 'var(--primary-color)', 400: '#fbbf24' }, dark: { 900: '#0f0f0f', 800: '#1a1a1a' } }
                }
            }
        }
    </script>
    <style>
        :root { --primary-color: #d4af37; }
        body { background-color: #0f0f0f; color: #f3f4f6; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        .falling-item { position: fixed; top: -30px; z-index: 9999; pointer-events: none; animation: fall linear infinite; } 
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }
    </style>
</head>
<body class="font-sans leading-relaxed flex flex-col min-h-screen">

    <header class="fixed w-full top-0 z-50 bg-dark-900/90 backdrop-blur-md border-b border-white/10" id="main-header">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2">
                <span class="text-xl font-bold text-gold-500 tracking-wide">Ú©Ø§ÙÙ‡ Ø§Ø³Ú©Ø§ÛŒ Ù…ÙˆÙ†</span>
            </a>
            <nav class="hidden md:flex gap-6 text-sm font-medium">
                <a href="index.html" class="hover:text-gold-500 transition">Ø®Ø§Ù†Ù‡</a>
                <a href="menu.html" class="hover:text-gold-500 transition">Ù…Ù†Ùˆ</a>
                <a href="reservation.html" class="text-gold-500">Ø±Ø²Ø±Ùˆ Ù…ÛŒØ²</a>
            </nav>
        </div>
    </header>

    <main class="mt-24 container mx-auto px-4 mb-16 flex-grow">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            
            <div>
                <h2 class="text-3xl text-gold-500 font-bold mb-6">ÙØ¶Ø§Ù‡Ø§ÛŒ Ú©Ø§ÙÙ‡</h2>
                
                <div id="spaces-container" class="space-y-6">
                    <div class="bg-dark-800 h-32 rounded-lg animate-pulse border border-white/5"></div>
                    <div class="bg-dark-800 h-32 rounded-lg animate-pulse border border-white/5"></div>
                </div>
            </div>
    
            <div class="bg-dark-800 p-8 rounded-xl border border-gold-500/20 shadow-xl relative h-fit sticky top-24">
                <h2 class="text-2xl text-white font-bold mb-6 text-center">ÙØ±Ù… Ø±Ø²Ø±Ùˆ Ù…ÛŒØ²</h2>
                
                <form id="reservation-form" class="space-y-4">
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                        <input type="text" id="name" required class="w-full bg-dark-900 border border-white/10 rounded p-3 text-white focus:border-gold-500 focus:outline-none transition">
                    </div>
                    
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                        <input type="tel" id="phone" required class="w-full bg-dark-900 border border-white/10 rounded p-3 text-white focus:border-gold-500 focus:outline-none transition" placeholder="Ù…Ø«Ù„Ø§Ù‹: Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">ØªØ§Ø±ÛŒØ®</label>
                            <input type="date" id="date" required class="w-full bg-dark-900 border border-white/10 rounded p-3 text-gray-300 focus:border-gold-500 focus:outline-none transition">
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">Ø³Ø§Ø¹Øª</label>
                            <select id="time" class="w-full bg-dark-900 border border-white/10 rounded p-3 text-white focus:border-gold-500 focus:outline-none transition">
                                <option>Û±Û·:Û°Û° - Û±Û¸:Û³Û°</option>
                                <option>Û±Û¸:Û³Û° - Û²Û°:Û°Û°</option>
                                <option>Û²Û°:Û°Û° - Û²Û±:Û³Û°</option>
                                <option>Û²Û±:Û³Û° - Û²Û³:Û°Û°</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">ØªØ¹Ø¯Ø§Ø¯ Ù†ÙØ±Ø§Øª</label>
                            <select id="guests" class="w-full bg-dark-900 border border-white/10 rounded p-3 text-white focus:border-gold-500 focus:outline-none transition">
                                <option>Û² Ù†ÙØ±</option>
                                <option>Û³ ØªØ§ Û´ Ù†ÙØ±</option>
                                <option>Ûµ ØªØ§ Û¸ Ù†ÙØ±</option>
                                <option>Ø¨ÛŒØ´ØªØ± Ø§Ø² Û¸ Ù†ÙØ±</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ¶Ø§</label>
                            <select id="space" class="w-full bg-dark-900 border border-white/10 rounded p-3 text-white focus:border-gold-500 focus:outline-none transition">
                                <option value="General">Ø³Ø§Ù„Ù† Ø¹Ù…ÙˆÙ…ÛŒ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Ù…Ù†Ø§Ø³Ø¨Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                        <select id="occasion" class="w-full bg-dark-900 border border-white/10 rounded p-3 text-white focus:border-gold-500 focus:outline-none transition">
                            <option value="">Ù…Ø¹Ù…ÙˆÙ„ÛŒ</option>
                            <option>ØªÙˆÙ„Ø¯</option>
                            <option>Ø³Ø§Ù„Ú¯Ø±Ø¯ Ø§Ø²Ø¯ÙˆØ§Ø¬</option>
                            <option>Ø¬Ù„Ø³Ù‡ Ú©Ø§Ø±ÛŒ</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="w-full bg-gold-500 text-dark-900 font-bold py-3 rounded mt-4 hover:bg-gold-400 transition flex justify-center items-center">Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ</button>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-black py-8 border-t border-white/10 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-gold-500 font-bold text-xl mb-4">Ú©Ø§ÙÙ‡ Ø§Ø³Ú©Ø§ÛŒ Ù…ÙˆÙ†</h3>
            <p class="text-gray-500 text-sm mb-4">Ù…ÛŒØ²Ø¨Ø§Ù†ÛŒ Ù„Ø­Ø¸Ø§Øª Ù†Ø§Ø¨ Ø´Ù…Ø§</p>
            <div class="text-gray-600 text-xs">Â© 2024</div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            
            // 1. Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù†Ù…Ø§ÛŒØ´ ÙØ¶Ø§Ù‡Ø§ (Spaces)
            const spacesContainer = document.getElementById('spaces-container');
            const spaceSelect = document.getElementById('space');
            
            try {
                const res = await fetch('/api/spaces');
                const spaces = await res.json();
                
                if (spaces.length > 0) {
                    spacesContainer.innerHTML = '';
                    spaceSelect.innerHTML = ''; // Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                    
                    spaces.forEach(space => {
                        // Ø³Ø§Ø®Øª Ú©Ø§Ø±Øª Ù†Ù…Ø§ÛŒØ´ (Ø³Ù…Øª Ø±Ø§Ø³Øª)
                        spacesContainer.innerHTML += `
                            <div class="bg-dark-800 rounded-lg overflow-hidden flex h-32 border border-white/5 hover:border-gold-500/30 transition group">
                                <img src="${space.image}" class="w-1/3 object-cover group-hover:scale-105 transition duration-500" alt="${space.name}">
                                <div class="p-4 flex flex-col justify-center w-2/3">
                                    <h3 class="text-white font-bold text-lg text-gold-500">${space.name}</h3>
                                    <p class="text-gray-400 text-sm mt-1 line-clamp-2">${space.description}</p>
                                </div>
                            </div>
                        `;

                        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨ ÙØ±Ù… (Ø³Ù…Øª Ú†Ù¾)
                        const option = document.createElement('option');
                        option.value = space.name;
                        option.innerText = space.name;
                        spaceSelect.appendChild(option);
                    });
                } else {
                    spacesContainer.innerHTML = '<p class="text-gray-500">ÙØ¶Ø§ÛŒÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
                    spaceSelect.innerHTML = '<option value="General">Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ</option>';
                }
            } catch (e) {
                console.error('Error fetching spaces:', e);
                spacesContainer.innerHTML = '<p class="text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ¶Ø§Ù‡Ø§</p>';
            }

            // 2. Ø§Ø¹Ù…Ø§Ù„ ØªÙ… (Ú©Ø¯ Ù…Ø´ØªØ±Ú©)
            try {
                const res = await fetch('/api/theme');
                if(res.ok) {
                    const theme = await res.json();
                    const root = document.documentElement;
                    const occ = theme.occasion || 'none';
                    root.style.setProperty('--primary-color', theme.primary);
                    
                    if (occ === 'christmas') { root.style.setProperty('--primary-color', '#d42f2f'); createFallingEffect('â„ï¸'); }
                    else if (occ === 'yalda') { root.style.setProperty('--primary-color', '#b91c1c'); document.getElementById('main-header').style.backgroundColor='rgba(20,0,0,0.9)'; createFallingEffect('ğŸ‰'); }
                    else if (occ === 'valentine') { root.style.setProperty('--primary-color', '#db2777'); createFallingEffect('â¤ï¸'); }
                    else if (occ === 'nowruz') { root.style.setProperty('--primary-color', '#10b981'); createFallingEffect('ğŸŒ¸'); }
                }
            } catch(e) {}

            function createFallingEffect(emoji) {
                if(!document.getElementById('fall-style')){const s=document.createElement('style');s.id='fall-style';s.innerHTML=`.falling-item{position:fixed;top:-30px;z-index:9999;pointer-events:none;animation:fall linear infinite}@keyframes fall{to{transform:translateY(105vh) rotate(360deg)}}`;document.head.appendChild(s)}
                setInterval(()=>{const el=document.createElement('div');el.className='falling-item';el.innerText=emoji;el.style.left=Math.random()*100+'vw';el.style.fontSize=(Math.random()*20+10)+'px';el.style.animationDuration=(Math.random()*3+4)+'s';el.style.opacity=Math.random();document.body.appendChild(el);setTimeout(()=>el.remove(),7000)},400);
            }

            // 3. Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ
            const form = document.getElementById('reservation-form');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = form.querySelector('button');
                const prevText = btn.innerText;
                btn.disabled = true; btn.innerText = 'Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...';
                
                const data = {
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    date: document.getElementById('date').value,
                    time: document.getElementById('time').value,
                    guests: document.getElementById('guests').value,
                    space: document.getElementById('space').value,
                    occasion: document.getElementById('occasion').value
                };

                try {
                    const res = await fetch('/api/reservations', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data) });
                    if(res.ok) { alert('Ø±Ø²Ø±Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!'); form.reset(); }
                    else alert('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ');
                } catch(e) { alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±'); }
                finally { btn.disabled = false; btn.innerText = prevText; }
            });
        });
    </script>
</body>
</html>
